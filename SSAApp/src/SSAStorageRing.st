program SSAStorageRing

#define CURRENTS_NUM 272
#define DELAY_SECONDS 2.0

double totalCurrent = 0;
assign totalCurrent to "{prefix}:RF-SSAmpTower:DCCurrent-Mon";

double currents[CURRENTS_NUM];
assign currents to {
  "{prefix}:RF-SSAmp-H01AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H01AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H01AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H01BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H01BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H01PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H01PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H02AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H02AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H02BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H02BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H02PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H02PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H03AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H03AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H03BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H03BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H03PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H03PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H04AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H04AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H04BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H04BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H04PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H04PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H05AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H05AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H05BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H05BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H05PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H05PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H06AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H06AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H06BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H06BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H06PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H06PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H07AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H07AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H07BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H07BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H07PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H07PreAmp:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H08AM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H08AM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM01:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM01:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM02:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM02:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM03:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM03:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM04:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM04:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM05:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM05:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM06:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM06:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM07:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM07:Current2-Mon",
  "{prefix}:RF-SSAmp-H08BM08:Current1-Mon",
  "{prefix}:RF-SSAmp-H08BM08:Current2-Mon",
  "{prefix}:RF-SSAmp-H08PreAmp:Current1-Mon",
  "{prefix}:RF-SSAmp-H08PreAmp:Current2-Mon" };


float totalAux = 0.0;
int idx = 0;
ss calcTotal {
    state prepareReadings {
        when(delay(DELAY_SECONDS)) {
            totalAux = 0.0;
            for(idx = 0; idx < CURRENTS_NUM; idx++) {
                totalAux += pvGet(currents[idx], SYNC);
            }
            totalCurrent = totalAux;
        } state assignValue
    }

    state assignValue {
        entry {
            pvPut(totalCurrent);
        }
        when(delay(0.1)) {
        } state prepareReadings
    }
}

